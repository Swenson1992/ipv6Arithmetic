"use strict";function checkipv6(e){return/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))\s*$/.test(e)}function formatIPv6Preferred(e){var r="",t="Not a valid IPv6 Address",n=[];return checkipv6(e)&&(r=e.toLowerCase(),n=r.split(":"),n=trimColonsFromEnds(n),n=fillemptysegment(n),n=stripLeadingZeroes(n),n=removeConsecutiveZeroes(n),t=assembleBestRepresentation(n)),t}function trimColonsFromEnds(e){var r=e.length;return""==e[0]&&""==e[1]&&""==e[2]?(e.shift(),e.shift()):""==e[0]&&""==e[1]?e.shift():""==e[r-1]&&""==e[r-2]&&e.pop(),e}function fillemptysegment(e){var r=void 0,t=8;for(-1!=e[e.length-1].indexOf(".")&&(t=7),r=0;r<t;r++)if(""==e[r]){e[r]="0";break}for(;e.length<t;)e.splice(r,0,"0");return e}function stripLeadingZeroes(e){for(var r=e.length,t=0;t<r;t++){for(var n=e[t].split(""),s=0;s<3&&("0"==n[0]&&n.length>1);s++)n.splice(0,1);e[t]=n.join("")}return e}function removeConsecutiveZeroes(e){for(var r=-1,t=0,n=!1,s=0,d=-1,i=0;i<8;i++)n?"0"==e[i]?s+=1:(n=!1,s>t&&(r=d,t=s)):"0"==e[i]&&(n=!0,d=i,s=1);return s>t&&(r=d,t=s),t>1&&e.splice(r,t,""),e}function assembleBestRepresentation(e){var r="",t=e.length;""==e[0]&&(r=":");for(var n=0;n<t&&(r+=e[n],n!=t-1);n++)r+=":";return""==e[t-1]&&(r+=":"),r}function expand(e){var r="",t="";if(-1==e.indexOf("::"))r=e;else{for(var n=e.split("::"),s=0,d=0;d<n.length;d++)s+=n[d].split(":").length;r+=n[0]+":";for(var i=0;i<8-s;i++)r+="0000:";r+=n[1]}for(var a=r.split(":"),o=0;o<8;o++){for(;a[o].length<4;)a[o]="0"+a[o];t+=7!=o?a[o]+":":a[o]}return t}function findprefix(e){for(var r="",t=0;t<e;t++)r+="1",(t+1)%16==0&&(r+=":");for(var n=r.split(":"),s=n.length;n[s-1].length<16;)n[s-1]+="0";for(var d=0;d<s;d++)n[d]=parseInt(n[d],2),n[d]=n[d].toString(16);return n.join(":")}function prefixBitAndIPv6(e,r){for(var t=e.split(":"),n=r.split(":"),s=new Array,d=0;d<8;d++)t[d]=parseInt(t[d],16),n[d]=parseInt(n[d],16),s[d]=t[d]&n[d],s[d]=s[d].toString(16);return s.join(":")}function makeLastAddress(e,r){for(var t=r.split(":"),n=e.split(":"),s=new Array,d=0;d<8;d++)t[d]=parseInt(t[d],16),n[d]=parseInt(n[d],16),n[d]=65535^n[d],s[d]=n[d]^t[d],s[d]=s[d].toString(16);return s.join(":")}function calculate(e){var r=e.replace(/\s/g,"").split("/"),t=r[0],n=r[1],s={};return checkipv6(t)||console.error("["+t+"] This does not look like a valid IPv6 address"),s.Compressed_Address=formatIPv6Preferred(t)+"/"+n,s.Expanded_Address=expand(formatIPv6Preferred(t))+"/"+n,s.Prefix=expand(findprefix(n)+"::"),s.First_Address=prefixBitAndIPv6(expand(findprefix(n)+"::"),expand(formatIPv6Preferred(t))),s.Last_Address=makeLastAddress(expand(findprefix(n)+"::"),s.First_Address),s.Number_MaskIs64=Math.pow(2,64-n),s}function subnet_slashes(e,r){var t=e.replace(/\s/g,"").split("/"),n=expand(t[0]),s=parseInt(t[1]);if(!checkipv6(n))return"[ERROR] "+n+" looks like an invalid IPv6 address ";var d=Math.pow(2,r-s);if(r<s)return"[ERROR] "+n+" Make sure the selected slashes fit into the given network";var i=expand(findprefix(s)+"::"),a=expand(prefixBitAndIPv6(i,n)),o=a.replace(/:/g,""),f=new BigInteger(o,16),p=new BigInteger("2").pow(128-r),l=new Array;l[0]=f.toString(16);var v=[];v.push(formatIPv6Preferred(bigIntToIPv6(l[0]))+"/"+r);for(var c=1;c<d;c++)l[c]=f.add(p).toString(16),f=f.add(p),v.push(formatIPv6Preferred(bigIntToIPv6(l[c]))+"/"+r);return v}function getStartIndex(e){var r=e.replace(/\s/g,"").split("/"),t=expand(r[0]);if(!checkipv6(t))return"[ERROR] "+t+" looks like an invalid IPv6 address ";var n=t.replace(/:/g,"");return new BigInteger(n,16).toString(10)}function bigIntToIPv6(e){for(var r=[],t=0;t<8;t++)r.push(e.slice(4*t,4*(t+1)));return r.join(":")}var BigInteger=require("big-integer");exports.calculate=calculate,exports.subnet_slashes=subnet_slashes,exports.getStartIndex=getStartIndex,exports.checkipv6=checkipv6,exports.assembleBestRepresentation=assembleBestRepresentation,exports.bigIntToIPv6=bigIntToIPv6,exports.expand=expand,exports.trimColonsFromEnds=trimColonsFromEnds,exports.stripLeadingZeroes=stripLeadingZeroes,exports.removeConsecutiveZeroes=removeConsecutiveZeroes,exports.prefixBitAndIPv6=prefixBitAndIPv6,exports.makeLastAddress=makeLastAddress,exports.formatIPv6Preferred=formatIPv6Preferred,exports.findprefix=findprefix,exports.fillemptysegment=fillemptysegment;